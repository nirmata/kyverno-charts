---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.15.0
  name: imageverificationpolicies.nirmata.io
spec:
  group: nirmata.io
  names:
    kind: ImageVerificationPolicy
    listKind: ImageVerificationPolicyList
    plural: imageverificationpolicies
    singular: imageverificationpolicy
  scope: Cluster
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ImageVerificationPolicy the resource that contains the image
          verification policy definition.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Policy spec.
            properties:
              admission:
                default: true
                description: |-
                  Admission controls if rules are applied during admission.
                  Optional. Default value is "true".
                type: boolean
              events:
                description: |-
                  Events controls if rules are applied to events.
                  Optional. Default value is "false".
                type: boolean
              failureAction:
                default: Audit
                description: |-
                  FailureAction defines if an image verification policy rule violation should block
                  the cloud admission request (Enforce), or allow (Audit) the request
                  and report as fail in a policy report. Optional.
                  Allowed values are Audit or Enforce.
                enum:
                - Audit
                - Enforce
                type: string
              rules:
                items:
                  properties:
                    context:
                      items:
                        description: |-
                          ContextEntry adds variables and data sources to a rule Context. Either a
                          ConfigMap reference or a APILookup must be provided.
                        properties:
                          apiCall:
                            description: |-
                              APICall is an HTTP request to the Kubernetes API server, or other JSON web service.
                              The data returned is stored in the context with the name for the context entry.
                            properties:
                              data:
                                description: |-
                                  The data object specifies the POST data sent to the server.
                                  Only applicable when the method field is set to POST.
                                items:
                                  description: RequestData contains the HTTP POST
                                    data
                                  properties:
                                    key:
                                      description: Key is a unique identifier for
                                        the data value
                                      type: string
                                    value:
                                      description: Value is the data value
                                      x-kubernetes-preserve-unknown-fields: true
                                  required:
                                  - key
                                  - value
                                  type: object
                                type: array
                              default:
                                description: |-
                                  Default is an optional arbitrary JSON object that the context
                                  value is set to, if the apiCall returns error.
                                x-kubernetes-preserve-unknown-fields: true
                              jmesPath:
                                description: |-
                                  JMESPath is an optional JSON Match Expression that can be used to
                                  transform the JSON response returned from the server. For example
                                  a JMESPath of "items | length(@)" applied to the API server response
                                  for the URLPath "/apis/apps/v1/deployments" will return the total count
                                  of deployments across all namespaces.
                                type: string
                              method:
                                default: GET
                                description: Method is the HTTP request type (GET
                                  or POST). Defaults to GET.
                                enum:
                                - GET
                                - POST
                                type: string
                              service:
                                description: |-
                                  Service is an API call to a JSON web service.
                                  This is used for non-Kubernetes API server calls.
                                  It's mutually exclusive with the URLPath field.
                                properties:
                                  caBundle:
                                    description: |-
                                      CABundle is a PEM encoded CA bundle which will be used to validate
                                      the server certificate.
                                    type: string
                                  headers:
                                    description: Headers is a list of optional HTTP
                                      headers to be included in the request.
                                    items:
                                      properties:
                                        key:
                                          description: Key is the header key
                                          type: string
                                        value:
                                          description: Value is the header value
                                          type: string
                                      required:
                                      - key
                                      - value
                                      type: object
                                    type: array
                                  url:
                                    description: |-
                                      URL is the JSON web service URL. A typical form is
                                      `https://{service}.{namespace}:{port}/{path}`.
                                    type: string
                                required:
                                - url
                                type: object
                              urlPath:
                                description: |-
                                  URLPath is the URL path to be used in the HTTP GET or POST request to the
                                  Kubernetes API server (e.g. "/api/v1/namespaces" or  "/apis/apps/v1/deployments").
                                  The format required is the same format used by the `kubectl get --raw` command.
                                  See https://kyverno.io/docs/writing-policies/external-data-sources/#variables-from-kubernetes-api-server-calls
                                  for details.
                                  It's mutually exclusive with the Service field.
                                type: string
                            type: object
                          name:
                            description: Name is the variable name.
                            type: string
                          variable:
                            description: Variable defines an arbitrary JMESPath context
                              variable that can be defined inline.
                            properties:
                              default:
                                description: |-
                                  Default is an optional arbitrary JSON object that the variable may take if the JMESPath
                                  expression evaluates to nil
                                x-kubernetes-preserve-unknown-fields: true
                              jmesPath:
                                description: |-
                                  JMESPath is an optional JMESPath Expression that can be used to
                                  transform the variable.
                                type: string
                              value:
                                description: Value is any arbitrary JSON object representable
                                  in YAML or JSON form.
                                x-kubernetes-preserve-unknown-fields: true
                            type: object
                        type: object
                      type: array
                    count:
                      type: integer
                    imageExtractors:
                      items:
                        properties:
                          jmesPath:
                            description: |-
                              JMESPath is an optional JMESPath expression to apply to the image value.
                              This is useful when the extracted image begins with a prefix like 'docker://'.
                              The 'trim_prefix' function may be used to trim the prefix: trim_prefix(@, 'docker://').
                              Note - Image digest mutation may not be used when applying a JMESPAth to an image.
                            type: string
                          key:
                            description: |-
                              Key is an optional name of the field within 'path' that will be used to uniquely identify an image.
                              Note - this field MUST be unique.
                            type: string
                          name:
                            description: |-
                              Name is the entry the image will be available under 'images.<name>' in the context.
                              If this field is not defined, image entries will appear under 'images.custom'.
                            type: string
                          path:
                            description: |-
                              Path is the path to the object containing the image field in a custom resource.
                              It should be slash-separated. Each slash-separated key must be a valid YAML key or a wildcard '*'.
                              Wildcard keys are expanded in case of arrays or objects.
                            type: string
                          value:
                            description: |-
                              Value is an optional name of the field within 'path' that points to the image URI.
                              This is useful when a custom 'key' is also defined.
                            type: string
                        required:
                        - path
                        type: object
                      type: array
                    match:
                      description: Match defines collections of assertion trees.
                      properties:
                        all:
                          description: All allows specifying assertion trees which
                            will be ANDed.
                          items:
                            description: Any can be any type.
                            type: object
                            x-kubernetes-preserve-unknown-fields: true
                          type: array
                        any:
                          description: Any allows specifying assertion trees which
                            will be ORed.
                          items:
                            description: Any can be any type.
                            type: object
                            x-kubernetes-preserve-unknown-fields: true
                          type: array
                      type: object
                    name:
                      type: string
                    verify:
                      description: VerificationRules is a set of VerificationPolicy
                      items:
                        description: VerificationRule is a rule against which images
                          are validated.
                        properties:
                          cosign:
                            description: Cosign is an array of attributes used to
                              verify cosign signatures
                            items:
                              description: Cosign is a set of attributes used to verify
                                cosign signatures
                              properties:
                                certificate:
                                  properties:
                                    cert:
                                      type: string
                                    certChain:
                                      type: string
                                  type: object
                                ctlog:
                                  properties:
                                    pubKey:
                                      type: string
                                  type: object
                                ignoreSCT:
                                  type: boolean
                                ignoreTlog:
                                  type: boolean
                                intotoAttestations:
                                  items:
                                    properties:
                                      conditions:
                                        description: |-
                                          Conditions are used to verify attributes within a Predicate. If no Conditions are specified
                                          the attestation check is satisfied as long there are predicates that match the predicate type.
                                        items:
                                          description: |-
                                            AnyAllConditions consists of conditions wrapped denoting a logical criteria to be fulfilled.
                                            AnyConditions get fulfilled when at least one of its sub-conditions passes.
                                            AllConditions get fulfilled only when all of its sub-conditions pass.
                                          properties:
                                            all:
                                              description: |-
                                                AllConditions enable variable-based conditional rule execution. This is useful for
                                                finer control of when an rule is applied. A condition can reference object data
                                                using JMESPath notation.
                                                Here, all of the conditions need to pass
                                              items:
                                                description: Condition defines variable-based
                                                  conditional criteria for rule execution.
                                                properties:
                                                  key:
                                                    description: Key is the context
                                                      entry (using JMESPath) for conditional
                                                      rule evaluation.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                  message:
                                                    description: Message is an optional
                                                      display message
                                                    type: string
                                                  operator:
                                                    description: |-
                                                      Operator is the conditional operation to perform. Valid operators are:
                                                      Equals, NotEquals, In, AnyIn, AllIn, NotIn, AnyNotIn, AllNotIn, GreaterThanOrEquals,
                                                      GreaterThan, LessThanOrEquals, LessThan, DurationGreaterThanOrEquals, DurationGreaterThan,
                                                      DurationLessThanOrEquals, DurationLessThan
                                                    enum:
                                                    - Equals
                                                    - NotEquals
                                                    - In
                                                    - AnyIn
                                                    - AllIn
                                                    - NotIn
                                                    - AnyNotIn
                                                    - AllNotIn
                                                    - GreaterThanOrEquals
                                                    - GreaterThan
                                                    - LessThanOrEquals
                                                    - LessThan
                                                    - DurationGreaterThanOrEquals
                                                    - DurationGreaterThan
                                                    - DurationLessThanOrEquals
                                                    - DurationLessThan
                                                    type: string
                                                  value:
                                                    description: |-
                                                      Value is the conditional value, or set of values. The values can be fixed set
                                                      or can be variables declared using JMESPath.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                type: object
                                              type: array
                                            any:
                                              description: |-
                                                AnyConditions enable variable-based conditional rule execution. This is useful for
                                                finer control of when an rule is applied. A condition can reference object data
                                                using JMESPath notation.
                                                Here, at least one of the conditions need to pass
                                              items:
                                                description: Condition defines variable-based
                                                  conditional criteria for rule execution.
                                                properties:
                                                  key:
                                                    description: Key is the context
                                                      entry (using JMESPath) for conditional
                                                      rule evaluation.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                  message:
                                                    description: Message is an optional
                                                      display message
                                                    type: string
                                                  operator:
                                                    description: |-
                                                      Operator is the conditional operation to perform. Valid operators are:
                                                      Equals, NotEquals, In, AnyIn, AllIn, NotIn, AnyNotIn, AllNotIn, GreaterThanOrEquals,
                                                      GreaterThan, LessThanOrEquals, LessThan, DurationGreaterThanOrEquals, DurationGreaterThan,
                                                      DurationLessThanOrEquals, DurationLessThan
                                                    enum:
                                                    - Equals
                                                    - NotEquals
                                                    - In
                                                    - AnyIn
                                                    - AllIn
                                                    - NotIn
                                                    - AnyNotIn
                                                    - AllNotIn
                                                    - GreaterThanOrEquals
                                                    - GreaterThan
                                                    - LessThanOrEquals
                                                    - LessThan
                                                    - DurationGreaterThanOrEquals
                                                    - DurationGreaterThan
                                                    - DurationLessThanOrEquals
                                                    - DurationLessThan
                                                    type: string
                                                  value:
                                                    description: |-
                                                      Value is the conditional value, or set of values. The values can be fixed set
                                                      or can be variables declared using JMESPath.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                type: object
                                              type: array
                                          type: object
                                        type: array
                                      type:
                                        type: string
                                    type: object
                                  type: array
                                key:
                                  properties:
                                    publicKey:
                                      type: string
                                  type: object
                                keyless:
                                  properties:
                                    issuer:
                                      type: string
                                    root:
                                      type: string
                                    subject:
                                      type: string
                                  type: object
                                rekor:
                                  properties:
                                    pubKey:
                                      type: string
                                    url:
                                      type: string
                                  type: object
                                repository:
                                  type: string
                                signatureAlgorithm:
                                  type: string
                                tsaCertChain:
                                  type: string
                              type: object
                            type: array
                          externalService:
                            description: ExternalService is an array of attributes
                              used to verify image signatures using API call
                            items:
                              description: ExternalService is a set of attributes
                                used to make API calls for image verification
                              properties:
                                apiCall:
                                  properties:
                                    data:
                                      description: |-
                                        The data object specifies the POST data sent to the server.
                                        Only applicable when the method field is set to POST.
                                      items:
                                        description: RequestData contains the HTTP
                                          POST data
                                        properties:
                                          key:
                                            description: Key is a unique identifier
                                              for the data value
                                            type: string
                                          value:
                                            description: Value is the data value
                                            x-kubernetes-preserve-unknown-fields: true
                                        required:
                                        - key
                                        - value
                                        type: object
                                      type: array
                                    default:
                                      description: |-
                                        Default is an optional arbitrary JSON object that the context
                                        value is set to, if the apiCall returns error.
                                      x-kubernetes-preserve-unknown-fields: true
                                    jmesPath:
                                      description: |-
                                        JMESPath is an optional JSON Match Expression that can be used to
                                        transform the JSON response returned from the server. For example
                                        a JMESPath of "items | length(@)" applied to the API server response
                                        for the URLPath "/apis/apps/v1/deployments" will return the total count
                                        of deployments across all namespaces.
                                      type: string
                                    method:
                                      default: GET
                                      description: Method is the HTTP request type
                                        (GET or POST). Defaults to GET.
                                      enum:
                                      - GET
                                      - POST
                                      type: string
                                    service:
                                      description: |-
                                        Service is an API call to a JSON web service.
                                        This is used for non-Kubernetes API server calls.
                                        It's mutually exclusive with the URLPath field.
                                      properties:
                                        caBundle:
                                          description: |-
                                            CABundle is a PEM encoded CA bundle which will be used to validate
                                            the server certificate.
                                          type: string
                                        headers:
                                          description: Headers is a list of optional
                                            HTTP headers to be included in the request.
                                          items:
                                            properties:
                                              key:
                                                description: Key is the header key
                                                type: string
                                              value:
                                                description: Value is the header value
                                                type: string
                                            required:
                                            - key
                                            - value
                                            type: object
                                          type: array
                                        url:
                                          description: |-
                                            URL is the JSON web service URL. A typical form is
                                            `https://{service}.{namespace}:{port}/{path}`.
                                          type: string
                                      required:
                                      - url
                                      type: object
                                    urlPath:
                                      description: |-
                                        URLPath is the URL path to be used in the HTTP GET or POST request to the
                                        Kubernetes API server (e.g. "/api/v1/namespaces" or  "/apis/apps/v1/deployments").
                                        The format required is the same format used by the `kubectl get --raw` command.
                                        See https://kyverno.io/docs/writing-policies/external-data-sources/#variables-from-kubernetes-api-server-calls
                                        for details.
                                        It's mutually exclusive with the Service field.
                                      type: string
                                  type: object
                                conditions:
                                  items:
                                    description: |-
                                      AnyAllConditions consists of conditions wrapped denoting a logical criteria to be fulfilled.
                                      AnyConditions get fulfilled when at least one of its sub-conditions passes.
                                      AllConditions get fulfilled only when all of its sub-conditions pass.
                                    properties:
                                      all:
                                        description: |-
                                          AllConditions enable variable-based conditional rule execution. This is useful for
                                          finer control of when an rule is applied. A condition can reference object data
                                          using JMESPath notation.
                                          Here, all of the conditions need to pass
                                        items:
                                          description: Condition defines variable-based
                                            conditional criteria for rule execution.
                                          properties:
                                            key:
                                              description: Key is the context entry
                                                (using JMESPath) for conditional rule
                                                evaluation.
                                              x-kubernetes-preserve-unknown-fields: true
                                            message:
                                              description: Message is an optional
                                                display message
                                              type: string
                                            operator:
                                              description: |-
                                                Operator is the conditional operation to perform. Valid operators are:
                                                Equals, NotEquals, In, AnyIn, AllIn, NotIn, AnyNotIn, AllNotIn, GreaterThanOrEquals,
                                                GreaterThan, LessThanOrEquals, LessThan, DurationGreaterThanOrEquals, DurationGreaterThan,
                                                DurationLessThanOrEquals, DurationLessThan
                                              enum:
                                              - Equals
                                              - NotEquals
                                              - In
                                              - AnyIn
                                              - AllIn
                                              - NotIn
                                              - AnyNotIn
                                              - AllNotIn
                                              - GreaterThanOrEquals
                                              - GreaterThan
                                              - LessThanOrEquals
                                              - LessThan
                                              - DurationGreaterThanOrEquals
                                              - DurationGreaterThan
                                              - DurationLessThanOrEquals
                                              - DurationLessThan
                                              type: string
                                            value:
                                              description: |-
                                                Value is the conditional value, or set of values. The values can be fixed set
                                                or can be variables declared using JMESPath.
                                              x-kubernetes-preserve-unknown-fields: true
                                          type: object
                                        type: array
                                      any:
                                        description: |-
                                          AnyConditions enable variable-based conditional rule execution. This is useful for
                                          finer control of when an rule is applied. A condition can reference object data
                                          using JMESPath notation.
                                          Here, at least one of the conditions need to pass
                                        items:
                                          description: Condition defines variable-based
                                            conditional criteria for rule execution.
                                          properties:
                                            key:
                                              description: Key is the context entry
                                                (using JMESPath) for conditional rule
                                                evaluation.
                                              x-kubernetes-preserve-unknown-fields: true
                                            message:
                                              description: Message is an optional
                                                display message
                                              type: string
                                            operator:
                                              description: |-
                                                Operator is the conditional operation to perform. Valid operators are:
                                                Equals, NotEquals, In, AnyIn, AllIn, NotIn, AnyNotIn, AllNotIn, GreaterThanOrEquals,
                                                GreaterThan, LessThanOrEquals, LessThan, DurationGreaterThanOrEquals, DurationGreaterThan,
                                                DurationLessThanOrEquals, DurationLessThan
                                              enum:
                                              - Equals
                                              - NotEquals
                                              - In
                                              - AnyIn
                                              - AllIn
                                              - NotIn
                                              - AnyNotIn
                                              - AllNotIn
                                              - GreaterThanOrEquals
                                              - GreaterThan
                                              - LessThanOrEquals
                                              - LessThan
                                              - DurationGreaterThanOrEquals
                                              - DurationGreaterThan
                                              - DurationLessThanOrEquals
                                              - DurationLessThan
                                              type: string
                                            value:
                                              description: |-
                                                Value is the conditional value, or set of values. The values can be fixed set
                                                or can be variables declared using JMESPath.
                                              x-kubernetes-preserve-unknown-fields: true
                                          type: object
                                        type: array
                                    type: object
                                  type: array
                              type: object
                            type: array
                          imageReferences:
                            description: |-
                              ImageReferences is a list of matching image reference patterns. At least one pattern in the
                              list must match the image for the rule to apply. Each image reference consists of a registry
                              address, repository, image, and tag (defaults to latest). Wildcards ('*' and '?') are allowed.
                            items:
                              type: string
                            type: array
                          notary:
                            description: Notary is an array of attributes used to
                              verify notary signatures
                            items:
                              description: Notary is a set of attributes used to verify
                                notary signatures
                              properties:
                                attestations:
                                  items:
                                    properties:
                                      conditions:
                                        description: |-
                                          Conditions are used to verify attributes within a Predicate. If no Conditions are specified
                                          the attestation check is satisfied as long there are predicates that match the predicate type.
                                        items:
                                          description: |-
                                            AnyAllConditions consists of conditions wrapped denoting a logical criteria to be fulfilled.
                                            AnyConditions get fulfilled when at least one of its sub-conditions passes.
                                            AllConditions get fulfilled only when all of its sub-conditions pass.
                                          properties:
                                            all:
                                              description: |-
                                                AllConditions enable variable-based conditional rule execution. This is useful for
                                                finer control of when an rule is applied. A condition can reference object data
                                                using JMESPath notation.
                                                Here, all of the conditions need to pass
                                              items:
                                                description: Condition defines variable-based
                                                  conditional criteria for rule execution.
                                                properties:
                                                  key:
                                                    description: Key is the context
                                                      entry (using JMESPath) for conditional
                                                      rule evaluation.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                  message:
                                                    description: Message is an optional
                                                      display message
                                                    type: string
                                                  operator:
                                                    description: |-
                                                      Operator is the conditional operation to perform. Valid operators are:
                                                      Equals, NotEquals, In, AnyIn, AllIn, NotIn, AnyNotIn, AllNotIn, GreaterThanOrEquals,
                                                      GreaterThan, LessThanOrEquals, LessThan, DurationGreaterThanOrEquals, DurationGreaterThan,
                                                      DurationLessThanOrEquals, DurationLessThan
                                                    enum:
                                                    - Equals
                                                    - NotEquals
                                                    - In
                                                    - AnyIn
                                                    - AllIn
                                                    - NotIn
                                                    - AnyNotIn
                                                    - AllNotIn
                                                    - GreaterThanOrEquals
                                                    - GreaterThan
                                                    - LessThanOrEquals
                                                    - LessThan
                                                    - DurationGreaterThanOrEquals
                                                    - DurationGreaterThan
                                                    - DurationLessThanOrEquals
                                                    - DurationLessThan
                                                    type: string
                                                  value:
                                                    description: |-
                                                      Value is the conditional value, or set of values. The values can be fixed set
                                                      or can be variables declared using JMESPath.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                type: object
                                              type: array
                                            any:
                                              description: |-
                                                AnyConditions enable variable-based conditional rule execution. This is useful for
                                                finer control of when an rule is applied. A condition can reference object data
                                                using JMESPath notation.
                                                Here, at least one of the conditions need to pass
                                              items:
                                                description: Condition defines variable-based
                                                  conditional criteria for rule execution.
                                                properties:
                                                  key:
                                                    description: Key is the context
                                                      entry (using JMESPath) for conditional
                                                      rule evaluation.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                  message:
                                                    description: Message is an optional
                                                      display message
                                                    type: string
                                                  operator:
                                                    description: |-
                                                      Operator is the conditional operation to perform. Valid operators are:
                                                      Equals, NotEquals, In, AnyIn, AllIn, NotIn, AnyNotIn, AllNotIn, GreaterThanOrEquals,
                                                      GreaterThan, LessThanOrEquals, LessThan, DurationGreaterThanOrEquals, DurationGreaterThan,
                                                      DurationLessThanOrEquals, DurationLessThan
                                                    enum:
                                                    - Equals
                                                    - NotEquals
                                                    - In
                                                    - AnyIn
                                                    - AllIn
                                                    - NotIn
                                                    - AnyNotIn
                                                    - AllNotIn
                                                    - GreaterThanOrEquals
                                                    - GreaterThan
                                                    - LessThanOrEquals
                                                    - LessThan
                                                    - DurationGreaterThanOrEquals
                                                    - DurationGreaterThan
                                                    - DurationLessThanOrEquals
                                                    - DurationLessThan
                                                    type: string
                                                  value:
                                                    description: |-
                                                      Value is the conditional value, or set of values. The values can be fixed set
                                                      or can be variables declared using JMESPath.
                                                    x-kubernetes-preserve-unknown-fields: true
                                                type: object
                                              type: array
                                          type: object
                                        type: array
                                      type:
                                        type: string
                                    type: object
                                  type: array
                                certs:
                                  type: string
                              required:
                              - certs
                              type: object
                            type: array
                        required:
                        - imageReferences
                        type: object
                      type: array
                  required:
                  - imageExtractors
                  - name
                  - verify
                  type: object
                type: array
              scan:
                default: true
                description: |-
                  Scan controls if rules are applied during cloud scanning.
                  Optional. Default value is "true".
                type: boolean
            required:
            - rules
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
