# CRD Chart Configuration
# Set to false to skip CRD installation (useful if managing CRDs separately)
crds:
  install: true

replicaCount: 1

image:
  repository: reg.nirmata.io/nirmata/go-agent-remediator
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

jobConfigurations:
  image:
    # -- (string) Image registry
    registry: ghcr.io
    # -- Image repository
    repository: nirmata/kubectl
    # -- Image tag
    # Defaults to `latest` if omitted
    tag: '1.34.0'
    # -- (string) Image pull policy
    # Defaults to image.pullPolicy if omitted
    pullPolicy: IfNotPresent

  # -- Image pull secrets
  imagePullSecrets: []

  # -- Security context for the pod
  podSecurityContext: {}

  # -- Node labels for pod assignment
  nodeSelector: {}

  # -- List of node taints to tolerate
  tolerations: []

  # -- Pod anti affinity constraints.
  podAntiAffinity: {}

  # -- Pod affinity constraints.
  podAffinity: {}

  # -- Pod labels.
  podLabels: {}

  # -- Pod annotations.
  podAnnotations: {}

  # -- Node affinity constraints.
  nodeAffinity: {}

  # -- Security context for the hook containers
  securityContext:
    runAsUser: 65534
    runAsGroup: 65534
    runAsNonRoot: true
    privileged: false
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
    seccompProfile:
      type: RuntimeDefault

serviceAccount:
  create: true
  annotations: {}
  name: ""


resources:
  limits:
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Logging configuration
logging:
  # Set verbosity level (0=info, 1=audit+info, 2=debug+audit+info)
  verbosity: 0
  # Enable audit logging (if true, overrides verbosity=0 to ensure audit logs are visible)
  enableAudit: false

nodeSelector: {}
tolerations: []
affinity: {}

# LLM provider configuration for creating an LLMConfig CR
llm:
  enabled: true
  provider: "nirmataAI"  # Options: bedrock, azure-openai
  bedrock:
    model: ""
    region: ""
    secretRef:
      name: ""
      # Optional for some auth methods
      key: "aws_access_key_id"
  azureOpenAI:
    endpoint: ""
    deploymentName: ""
    secretRef:
      name: ""
      # Defaults to standard header key
      key: "api-key"
  nirmataAI:
    model: ""

nirmata:
  # Nirmata endpoint URL - used to set the --url command-line flag
  endpoint: "https://nirmata.io"

  # Service Account Token configuration
  # Name of secret containing Nirmata service account token - used to set the --service-account-token-secret command-line flag
  # Create manually: kubectl create secret generic nirmata-service-account-token --from-literal=service-account-token=YOUR_TOKEN -n nirmata
  serviceAccountTokenSecret: ""

  # Namespace of secret containing Nirmata service account token - used to set the --service-account-token-secret-namespace command-line flag
  serviceAccountTokenSecretNamespace: ""

  # Key within the secret containing Nirmata service account token - used to set the --service-account-token-secret-key command-line flag
  # Defaults to "service-account-token"
  serviceAccountTokenSecretKey: ""

  # API Token configuration (alternative to service account token)
  # Only one of serviceAccountToken or apiToken should be configured
  # If both are present, serviceAccountToken takes precedence
  # Name of secret containing Nirmata API token - used to set the --api-token-secret command-line flag
  # Create manually: kubectl create secret generic nirmata-api-token --from-literal=api-token=YOUR_API_TOKEN -n nirmata
  apiTokenSecret: ""

  # Namespace of secret containing Nirmata API token - used to set the --api-token-secret-namespace command-line flag
  apiTokenSecretNamespace: ""

  # Key within the secret containing Nirmata API token - used to set the --api-token-secret-key command-line flag
  apiTokenSecretKey: ""

# ToolConfig for GitHub (used by CreatePR)
tool:
  enabled: true
  name: github-tool
  type: github

  # Authentication method configuration
  # Choose between "pat" (Personal Access Token) or "app" (GitHub App)
  credentials:
    method: pat  # Options: "pat" or "app" (recommended: "app" for better security)

    # app:
    #   appId: ""  # Set this to your GitHub App ID
    #   # installationId: ""  # Optional: set if you want to specify installation ID
    #   privateKeySecret:
    #     name: "github-app-private-key"
    #     key: "private-key.pem"

    # PAT configuration (used when method: pat)
    pat:
      secret:
        name: "github-token"
        key: "token"

  defaults:
    git:
      pullRequests:
        branchPrefix: remediation-

# Remediator CR
remediator:
  enabled: false
  name: remediator-agent
  environment:
    type: argoHub  # Options: localCluster, argoHub (vcsTarget can be used with any environment type)
  target:
    argoHub:
      clusterNames: []
      clusterServerUrls: []
      appSelector:
        allApps: true
    # localCluster:
    #   repoNamespaceMappingRef:
    #     name: repo-namespace-mapping
    #     namespace: nirmata
    #     key: mapping
    # vcs:
    #   policies:
    #     - name: pss-restricted
    #       repo: https://github.com/nirmata/kyverno-policies
    #       path: pod-security/restricted
    #       ref: main
    #   resources:
    #     - name: nginx-deployment
    #       repo: https://github.com/nirmata/demo-remediator
    #       path: apps/nginx
    #       ref: main
    #       policyRefs:
    #         - pss-restricted
  remediation:
    schedule: "0 */6 * * *"
    eventPolling:
      enabled: true
      # intervalMinutes: 5  # Optional: polling interval in minutes (default: 5)
    actions:
      - type: CreatePR
        toolRefName: github-tool
